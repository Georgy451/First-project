{% extends "song/base.html" %}

{% block content %}
<section class="tracks-window">
    <div class="tracks-header">
        <h3>Мои треки</h3>
        <div class="search-box">
            <input type="text" id="track-search" placeholder="Поиск треков...">
            <i class="fas fa-search"></i>
        </div>
    </div>

    <!-- Окно с плейлистами -->
    <section class="playlists-section" style="margin-bottom: 30px; background: rgba(255,255,255,0.07); border-radius: 16px; padding: 24px;">
        <h2>Мои плейлисты</h2>
        <ul>
         {% for playlist in playlists %}
        <li>{{ playlist.name }}</li>
          {% empty %}
        <li>У вас пока нет плейлистов.</li>
         {% endfor %}
        </ul>
        <form method="post" style="margin-top: 16px;">
            {% csrf_token %}
            <input type="text" name="playlist_name" placeholder="Название нового плейлиста" style="width: 60%; border-radius: 8px; padding: 6px;">
            <button type="submit" name="add_playlist" style="margin-left: 8px;">Создать плейлист</button>
        </form>
    </section>

    <!-- Форма загрузки трека -->
    <section class="upload-section" style="margin-bottom: 30px;">
        <h2>Загрузить свою музыку</h2>
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        <form method="post" enctype="multipart/form-data" class="upload-form">
            {% csrf_token %}
            <div class="form-group">
                {{ form.title }}
            </div>
            <div class="form-group">
                {{ form.audio_file }}
            </div>
            <button type="submit" class="upload-button">Загрузить</button>
        </form>
    </section>

    <section class="add-to-playlist-section" style="margin-bottom: 30px; background: rgba(255,255,255,0.07); border-radius: 16px; padding: 24px;">
    <h2>Добавить трек в плейлист</h2>
    <form method="post" style="display: inline-block; margin-right: 16px;">
        {% csrf_token %}
        <label for="track_id">Трек:</label>
        <select name="track_id" id="track_id">
            {% for song in songs %}
                <option value="{{ song.id }}">{{ song.title }}</option>
            {% endfor %}
        </select>
        <label for="playlist_id">Плейлист:</label>
        <select name="playlist_id" id="playlist_id">
            {% for playlist in playlists %}
                <option value="{{ playlist.id }}">{{ playlist.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" name="add_to_playlist">Добавить</button>
    </form>
    <!-- Форма для удаления плейлиста -->
    <form method="post" style="display: inline-block; margin-right: 16px;">
        {% csrf_token %}
        <label for="delete_playlist_id">Плейлист:</label>
        <select name="delete_playlist_id" id="delete_playlist_id">
            {% for playlist in playlists %}
                <option value="{{ playlist.id }}">{{ playlist.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" name="delete_playlist" style="background: #e74c3c; color: #fff;">Удалить плейлист</button>
    </form>
    <!-- Форма для удаления трека -->
    <form method="post" style="display: inline-block;">
        {% csrf_token %}
        <label for="delete_track_id">Трек:</label>
        <select name="delete_track_id" id="delete_track_id">
            {% for song in songs %}
                <option value="{{ song.id }}">{{ song.title }}</option>
            {% endfor %}
        </select>
        <button type="submit" name="delete_track" style="background: #e67e22; color: #fff;">Удалить трек</button>
    </form>
</section>

    <div class="tracks-list-container">
        <ul class="tracks-list">
            {% for song in songs %}
            <li class="track-item" data-audio-url="{{ song.audio_file.url }}">
                <div class="track-info">
                    <span class="track-title">{{ song.title }}</span>
                </div>
                <button class="play-btn" data-audio-url="{{ song.audio_file.url }}">
                    <i class="fas fa-play"></i>
                </button>
            </li>
            {% empty %}
            <li class="no-tracks">У вас пока нет загруженных треков</li>
            {% endfor %}
        </ul>
    </div>
</section>
{% endblock %}